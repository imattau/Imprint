{% extends 'base.html' %}
{% block title %}Imprint ¬∑ Editor{% endblock %}
{% block extra_head %}
<link rel="stylesheet" href="/static/vendor/easymde/easymde.min.css">
<link rel="stylesheet" href="/static/editor.css">
{% endblock %}
{% block content %}
<section class="stack">
    <p class="eyebrow">Editor</p>
    <h1>{{ 'Revise essay' if identifier else 'New essay' }}</h1>
    <p class="lede">Write in Markdown on the left and watch the preview update. Save a local draft or publish to relays.</p>
</section>
<div class="editor-layout">
    <form method="post" action="/publish" class="editor-form" data-default-mode="{{ editor_mode|default('') }}">
        <input type="hidden" name="identifier" value="{{ identifier or '' }}">
        {% if draft_id %}
            <input type="hidden" name="draft_id" value="{{ draft_id }}">
        {% endif %}
        <div class="editor-grid">
            <details class="editor-section editor-details" open>
                <summary class="section-head row space-between align-center">
                    <span class="section-title">Details</span>
                    <span class="muted small">Title, tags, summary</span>
                </summary>
                <div class="details-grid">
                    <label class="field col-6">
                        <span>Title</span>
                        <input id="title" type="text" name="title" value="{{ title }}" required>
                    </label>
                    <label class="field col-6">
                        <span>Tags</span>
                        <input id="tags" type="text" name="tags" value="{{ tags or '' }}" placeholder="nostr, writing, tech">
                    </label>
                    <label class="field col-12">
                        <span>Summary (optional)</span>
                        <textarea id="summary" name="summary" rows="2">{{ summary or '' }}</textarea>
                    </label>
                </div>
            </details>
            <section class="editor-panel editor-compose">
                <div class="editor-toolbar-row">
                    <div class="segmented" role="group" aria-label="Editor mode">
                        <button type="button" class="segment active" data-editor-mode="markdown" aria-pressed="true">Markdown</button>
                        <button type="button" class="segment" data-editor-mode="visual" aria-pressed="false">Visual</button>
                    </div>
                    <button type="button" id="toggle-preview" class="toolbar-toggle" aria-pressed="false" aria-label="Toggle preview">
                        <span aria-hidden="true">üëÅ</span>
                        <span>Preview</span>
                    </button>
                    <div class="toolbar-actions">
                        <button type="button" id="toggle-expand" class="icon-button compact" aria-pressed="false" aria-label="Expand editor" title="Expand editor">‚§¢</button>
                    </div>
                </div>
                <div class="editor-panel-body">
                    <label class="field">
                        <span class="sr-only">Content</span>
                        <textarea id="content" name="content" rows="12" hx-post="/preview" hx-trigger="keyup changed delay:300ms" hx-target="#preview" hx-swap="innerHTML">{{ content }}</textarea>
                    </label>
                </div>
            </section>
            <section class="editor-panel editor-preview">
                <div class="editor-panel-header row space-between align-center">
                    <h3>Preview</h3>
                    <span class="muted small">Live</span>
                </div>
                <div id="preview" class="prose" aria-live="polite"></div>
            </section>
        </div>
        <div class="editor-actions">
            <div class="status-message neutral" role="status">Use <strong>Save draft</strong> to keep changes locally. <strong>Publish</strong> sends the signed event to configured relays.</div>
            <div class="row wrap gap actions">
                <button type="submit" name="action" value="draft" class="button ghost" formaction="/drafts/save">Save draft</button>
                <button type="submit" name="action" value="publish" class="button">Publish</button>
            </div>
        </div>
    </form>
</div>
{% endblock %}
{% block extra_scripts %}
<script src="/static/vendor/easymde/easymde.min.js" defer></script>
<script src="/static/editor.js" defer></script>
{% endblock %}
