<div id="auth-status">
{% if session %}
<div class="auth-chip" hx-boost="false">
    <details class="profile-menu">
        <summary>
            <span class="avatar">âœ¦</span>
            {% set full_identity = session.display_name or session.npub or session.pubkey_hex %}
            <span class="identity">{{ full_identity|short_identity }}</span>
            {% if session.pubkey_hex %}
                <span class="sr-only pubkey-prefix">{{ session.pubkey_hex[:12] }}</span>
            {% endif %}
            <span class="muted small">
                {{ session.session_mode|title }}
                {% if session.session_mode == 'readonly' %}
                    <span class="badge subtle">Read-only</span>
                {% endif %}
            </span>
        </summary>
        <div class="menu">
            <a class="button ghost full" href="/drafts">Drafts</a>
            <a class="button ghost full" href="/history">Post history</a>
            <a class="button ghost full" href="/settings">Settings</a>
            {% if request.state.is_admin or allowlisted_admin %}
                <a class="button ghost full" href="/admin">Admin</a>
            {% endif %}
            <div class="menu-section">
                <div class="label">Session</div>
                <div class="value">{{ session.session_mode }}</div>
                {% if session.relay %}<div class="value">Relay: {{ session.relay }}</div>{% endif %}
            </div>
            <form hx-post="/auth/logout" hx-target="#auth-status" hx-swap="outerHTML" hx-on::after-request="window.closeAuthModal && window.closeAuthModal()">
                <button type="submit" class="ghost full">Sign out</button>
            </form>
            <button type="button" class="ghost full" onclick="window.showAuthModal && window.showAuthModal()">Switch account</button>
        </div>
    </details>
</div>
{% else %}
<button id="open-auth" class="button ghost" type="button" onclick="window.showAuthModal && window.showAuthModal()">Sign in</button>
{% endif %}
</div>
