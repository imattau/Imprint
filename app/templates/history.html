{% extends 'base.html' %}
{% block title %}Post history · Imprint{% endblock %}
{% block content %}
<section class="stack">
    <p class="eyebrow">Your posts</p>
    <h1>Post history</h1>
    <p class="lede">Recently published posts from your account.</p>
</section>

<div class="card stack">
    {% if history %}
        <ul class="list">
            {% for version in history %}
                <li class="row space-between align-start">
                    <div class="stack">
                        <strong>{{ version.essay.title }}</strong>
                        {% if version.published_at %}
                            <span class="muted small">Published {{ version.published_at }}</span>
                        {% endif %}
                        {% if version.event_id %}
                            <span class="muted small">Event: {{ version.event_id[:12] }}…</span>
                        {% endif %}
                        <span class="muted small">Identifier: {{ version.essay.identifier }}</span>
                    </div>
                    <div class="row gap wrap">
                        {% set link_id = version.essay.identifier | replace('-', '%2D') %}
                        <a class="button ghost" href="/essay/{{ link_id }}">View</a>
                        {% if not is_readonly %}
                            <a class="button ghost" href="/editor?d={{ link_id }}">Revise</a>
                        {% endif %}
                        {% set revs = revision_counts.get(version.essay.id, 1) %}
                        <a class="button ghost" href="/history/{{ link_id }}/revisions">Revisions ({{ revs }})</a>
                        <button class="button ghost" type="button" onclick="navigator.clipboard && navigator.clipboard.writeText('{{ request.url.scheme }}://{{ request.url.netloc }}/essay/{{ link_id }}')">Copy link</button>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="muted">No posts yet.</p>
    {% endif %}
</div>
{% endblock %}
